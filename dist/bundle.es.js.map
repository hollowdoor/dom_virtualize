{"version":3,"file":"bundle.es.js","sources":["../src/index.js"],"sourcesContent":["import { toElement } from 'dom-elementals';\n\nclass Virtualize {\n    constructor({\n        frame = document.createElement('div'),\n        parent = document.createElement('div'),\n        render = null,\n        afterAdd = ()=>{},\n        childHeight = 0,\n        classes = {}\n    }){\n        frame.style.width = '500px';\n        frame.style.height = '400px';\n        frame.style.border = '1px solid black';\n        frame.style.display = 'block';\n\n        const self = this;\n        frame.appendChild(parent);\n        //parent.style.height = childHeight + 'px';\n\n        this.startIndex = 0;\n\n        this.childHeight = childHeight;\n        this.data = [];\n        this.element = this.frame = frame;\n        this.container = this._parent = parent;\n        this._render = render;\n        this._afterAdd = afterAdd;\n        this.indexes = {\n            top: 0,\n            bottom: 0\n        };\n\n        /*let last = this.last = document.createElement('div');\n        last.style.width = '100%';\n        last.style.hight = '0px';\n        last.style.margin = '';\n        last.style.padding = '';\n        last.style.border = '1px solid red';\n        last.style.position = 'relative';\n        parent.appendChild(last);*/\n        frame.style.overflow = 'scroll';\n\n        /*let {\n            last = 'dom-virtualize-last'\n        } = (classes || {});\n\n        classes = this.classes = {\n            last\n        };*/\n\n        function onScroll(event){\n            self.expand();\n        }\n\n        frame.addEventListener('scroll', onScroll);\n\n        this.destroy = function(){\n            frame.removeEventListener('scroll', onScroll);\n        };\n    }\n    expand(){\n        let first = this._parent.firstChild;\n        let last = this._parent.lastChild;\n        let rect = last ? last.getBoundingClientRect() : null;\n        let outer = this.frame.getBoundingClientRect();\n        let parent = this._parent;\n        let bottom = this.indexes.bottom;\n        //console.log('outer ',outer);\n        //console.log('this.element.style.height ',this.element.style.height)\n        //console.log(!rect || rect.bottom >= outer.bottom)\n        if(!rect || rect.top <= outer.bottom){\n            let start = parent.children.length;\n            for(let i=start; i<this.data.length; i++){\n                if(last){\n                    rect = last.getBoundingClientRect();\n                    console.log('rect ', rect)\n                    if(rect.bottom >= outer.bottom && rect.right > outer.right - rect.width){\n                        break;\n                    }\n                }\n\n                //console.log('this.data[i] ',this.data[i])\n                let el = toElement(this._render(this.data[i]));\n                parent.appendChild(el);\n                last = el;\n                bottom = i;\n\n\n            }\n            //console.log('outer ',outer)\n            this.indexes.bottom = bottom;\n\n        }else if(rect.top > outer.bottom + 10){\n            for(let i=0; i<parent.children.length; i++){\n                let child = parent.children[i];\n                rect = child.getBoundingClientRect();\n                if(rect.top > outer.bottom + 10){\n                    parent.removeChild(child);\n                }\n            }\n        }\n\n        rect = parent.children[this.startIndex] ? parent.children[this.startIndex].getBoundingClientRect() : null;\n\n        if(rect){\n            console.log('top ',rect.bottom < outer.top - 10);\n            if(rect.bottom < outer.top - 10){\n                for(let i=0; i<parent.children.length; ++i){\n                    let child = parent.children[i];\n                    rect = child.getBoundingClientRect();\n                    if(rect.bottom < outer.top + 10){\n                        let placeholder = child.cloneNode();\n                        placeholder.innerHTML = '';\n                        parent.replaceChild(placeholder, child);\n                        this.startIndex = i;\n                    }\n                }\n            }else if(rect.bottom >= outer.top){\n                let start = this.startIndex;\n                console.log('start ',start);\n                for(let i=start; i>-1; --i){\n                    let current = parent.children[i];\n                    if(current){\n                        rect = current.getBoundingClientRect();\n                        console.log('rect ', rect)\n                        if(rect.bottom <= outer.top){\n                            this.startIndex = i;\n                            break;\n                        }\n                    }\n                    let el = toElement(this._render(this.data[i]));\n                    parent.replaceChild(el, current);\n                }\n            }\n        }\n\n\n    }\n    push(...data){\n        this.data = this.data.concat(data);\n        this._afterAdd();\n\n        //this._parent.style.height = (this.childHeight * this.data.length) + 'px';\n        this.expand();\n    }\n    appendTo(dest){\n        try{\n\n            dest.appendChild(this.element);\n        }catch(e){ console.error(e)}\n    }\n}\n\nexport default function virtualize(options){\n    return new Virtualize(options);\n}\n"],"names":["let","this","i","child","start","el"],"mappings":"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"}